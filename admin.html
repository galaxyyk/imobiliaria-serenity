document.getElementById('addEmailForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('emailInput').value.trim().toLowerCase();

  if (!email) return alert('Digite um email v√°lido.');

  try {
    await db.collection('allowedEmails').doc(email).set({
      email: email  // <-- isso aqui garante que o campo exista no doc
    });

    document.getElementById('emailInput').value = '';
    alert('Email autorizado com sucesso!');
    loadEmails(); // recarrega a lista
  } catch (error) {
    console.error("Erro ao adicionar email:", error);
    alert("Erro ao adicionar email.");
  }
});

async function loadEmails() {
  const emailList = document.getElementById('emailList');
  emailList.innerHTML = '';

  try {
    const querySnapshot = await db.collection('allowedEmails').get();
    querySnapshot.forEach((doc) => {
      const li = document.createElement('li');
      li.textContent = doc.id;

      const btn = document.createElement('button');
      btn.textContent = 'Remover';
      btn.onclick = async () => {
        await db.collection('allowedEmails').doc(doc.id).delete();
        loadEmails();
      };

      li.appendChild(btn);
      emailList.appendChild(li);
    });
  } catch (error) {
    console.error("Erro ao carregar emails:", error);
  }
}
